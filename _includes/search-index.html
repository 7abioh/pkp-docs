
<script>
	window.store = [
		{% for page in site.pages %}
			{% if page.url == '/' or page.url contains '/assets/' or page.url contains '/css/' or page.url contains '/js/' or page.title == 'Summary' %}
				{% continue %}
			{% endif %}
			{
				"id": {{ forloop.index }},
				"title": "{{ page.title | xml_escape }}",
				"content": {{ page.content | strip | strip_html | strip_newlines | replace: '	', ' ' | jsonify }},
				"url": "{{ page.url | xml_escape }}"
			}
			{% unless forloop.last %},{% endunless %}
		{% endfor %}
	];

	function pkpInitSearch() {
		if (typeof lunr !== 'undefined') {
			var idx = lunr(function () {
			  this.field('title');
			  this.field('content');

				for (var i in store) {
					this.add(store[i]);
				}
			});
			var result = idx.search('ojs');
			console.log(result);
		} else {
			setTimeout(pkpInitSearch, 500);
		}
	}
	pkpInitSearch();
</script>
